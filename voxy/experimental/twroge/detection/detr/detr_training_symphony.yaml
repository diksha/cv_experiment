##
## Copyright 2020-2021 Voxel Labs, Inc.
## All rights reserved.
##
## This document may not be reproduced, republished, distributed, transmitted,
## displayed, broadcast or otherwise exploited in any manner without the express
## prior written permission of Voxel Labs, Inc. The receipt or possession of this
## document does not convey any rights to reproduce, disclose, or distribute its
## contents, or to manufacture, use, or sell anything that it may describe, in
## whole or in part.
##

{% set hyper_parameters_path="/home/nasha_voxelsafety_com/voxel/experimental/nasha/data/hyper_parameter_sweep" %}
{% set image_tag=GENERATE_UUID_WITH_PREFIX("detr-training-") %}
{% set tmp_image_tag="detr-training-7772d21b-0741-486e-83fc-9aa5dc01f0c8" %}
{% set identifier=GENERATE_UUID_WITH_PREFIX("symphony-") %}
{% set dataset_path="/data/" %}
{% set output_path="/data/" %}


buildkite_jobs:
  -
    name: {{GENERATE_UUID_WITH_PREFIX("detr-training-")}}
    items: {{ITEMS_FROM_FILE(hyper_parameters_path)}}
    type: k8s
    command: /app/experimental/twroge/detection/detr/train_detr --identifier {{identifier}} --data {{dataset_path}} --output {{output_path}}
    image: us.gcr.io/sodium-carving-227300/voxel/execution/runners:{{tmp_image_tag}}
    gpus: 1
    cpus: 1
    attempts: 1
    memory_mb: 12000
    host_ipc: True
    node_pool_name: "preemptible-gpu-pool"
    active_deadline_seconds: 144000
